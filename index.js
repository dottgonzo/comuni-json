"use strict";
var _ = require("lodash");
var geo = require("geolib");
var world = require("./world.json");
var Localize = (function () {
    function Localize() {
    }
    Localize.prototype.getPosition = function (o) {
        if (!(o && o.latitude && o.longitude))
            throw Error("Error");
        var pos = { latitude: o.latitude, longitude: o.longitude };
        var _this = this;
        var State;
        if (o.state && _this.getState(o.state)) {
            State = _this.getState(o.state);
            console.log('ss');
        }
        else {
            console.log('todo');
            throw Error("todo");
        }
        var allprovinces = _this.getProvincesFromState(State.name);
        _.map(allprovinces, function (c) {
            c.distance = geo.getDistance({ latitude: c.latitude, longitude: c.longitude }, pos);
        });
        var reprov = _.take(_.orderBy(allprovinces, ['distance'], ['asc']), 2);
        var provinces = [];
        _.map(reprov, function (c) {
            _.map(_this.getProvinceFromCity(c.nativeName, State.name), function (p) {
                p.distance = geo.getDistance({ latitude: p.latitude, longitude: p.longitude }, pos);
                provinces.push(p);
            });
        });
        var cities = _.take(_.orderBy(provinces, ['distance'], ['asc']), 2);
        if (cities[0].distance * 1.4 > cities[0].distance) {
            cities = [cities[0]];
        }
        return cities;
    };
    Localize.prototype.getLocation = function (o) {
        return true;
    };
    Localize.prototype.getinfo = function (o) {
        return true;
    };
    Localize.prototype.getState = function (state, o) {
        var exists = false;
        var answer;
        _.map(world, function (continent) {
            _.map(continent.subcontinents, function (subcontinent) {
                _.map(subcontinent.countries, function (country) {
                    _.map(country.states, function (s) {
                        console.log(s.name);
                        if (s.name === state) {
                            exists = true;
                            answer = s;
                        }
                    });
                    if (!exists) {
                        answer = false;
                    }
                });
            });
        });
        return answer;
    };
    Localize.prototype.getProvincesFromState = function (state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.cities, function (c) {
                provinces.push(c);
            });
        });
        return provinces;
    };
    Localize.prototype.getProvinceFromCity = function (city, state) {
        var _this = this;
        var State;
        if (state) {
            State = _this.getState(state);
        }
        else {
            throw Error("todo");
        }
        var provinces = [];
        _.map(State.regions, function (r) {
            _.map(r.provinces, function (p) {
                if (p.main.nativeName === city) {
                    _.map(p.cities, function (c) {
                        provinces.push(c);
                    });
                }
            });
        });
        return provinces;
    };
    return Localize;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = Localize;

//# sourceMappingURL=data:application/json;base64,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QUFFLFVBQVUsQ0FBQztZQUM1QixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDO2dCQUMxQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUM3QixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDO3dCQUV2QixTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUdyQixDQUFDLENBQUMsQ0FBQTtnQkFDTixDQUFDO1lBR0wsQ0FBQyxDQUFDLENBQUE7UUFFTixDQUFDLENBQUMsQ0FBQTtRQUdGLE1BQU0sQ0FBQyxTQUFTLENBQUE7SUFFcEIsQ0FBQztJQUVMLGVBQUM7QUFBRCxDQTdLQSxBQTZLQyxJQUFBO0FBN0tEOzBCQTZLQyxDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XG5cbmxldCBnZW8gPSByZXF1aXJlKFwiZ2VvbGliXCIpO1xuXG5pbnRlcmZhY2UgSUJvdW5kYXJ5IHtcblxuICAgIGxhdGl0dWRlOiBudW1iZXI7XG4gICAgbG9uZ2l0dWRlOiBudW1iZXI7XG5cbn1cblxuaW50ZXJmYWNlIElHZW9jb2RlcyB7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHByb3ZpbmNlczogSUdlb1tdO1xuICAgIGNpdGllczogSUNpdHlbXVxufVxuXG5cblxuaW50ZXJmYWNlIElDaXR5IHtcbiAgICBuYXRpdmVOYW1lOiBzdHJpbmc7XG4gICAgbGF0aXR1ZGU6IG51bWJlcjtcbiAgICBsb25naXR1ZGU6IG51bWJlcjtcbiAgICB6aXBjb2RlOiBudW1iZXI7XG4gICAgY2l0eUNvZGU6IHN0cmluZztcbiAgICBzdGF0ZTogc3RyaW5nO1xuICAgIGNvdW50cnk6IHN0cmluZztcbiAgICBpc29MYW5nOiBzdHJpbmc7XG4gICAgdHo6IHN0cmluZztcbiAgICBjdXJyZW5jeTogc3RyaW5nO1xuICAgIGN1cnJlbmN5U3ltYm9sOiBzdHJpbmc7XG4gICAgZGlzdGFuY2U/OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBJR2VvIHtcbiAgICBuYXRpdmVOYW1lOiBzdHJpbmc7XG4gICAgemlwY29kZTogc3RyaW5nO1xuICAgIGNpdGllczogSUNpdHlbXTtcbiAgICBtYWluOiBJQ2l0eTtcbiAgICBsYXRpdHVkZTogbnVtYmVyO1xuICAgIGxvbmdpdHVkZTogbnVtYmVyO1xuXG59XG5cblxuaW50ZXJmYWNlIElzdGF0ZSB7XG4gICAgcmVnaW9uczogSUdlb2NvZGVzW107XG4gICAgYm91bmRhcmllczogSUJvdW5kYXJ5W107XG4gICAgY2FwaXRhbDogSUNpdHk7XG4gICAgbmF0aXZlTmFtZTogc3RyaW5nO1xuICAgIGxhdGxuZzogbnVtYmVyW107XG4gICAgaXNvTGFuZzogc3RyaW5nW107XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHR6OiBzdHJpbmc7XG5cbn1cblxuaW50ZXJmYWNlIElDb3VudHJ5IHtcbiAgICBzdGF0ZXM6IElzdGF0ZVtdO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBib3VuZGFyaWVzOiBJQm91bmRhcnlbXTtcbiAgICBuYXRpdmVOYW1lOiBzdHJpbmc7XG4gICAgY2FwaXRhbDogSUNpdHk7XG4gICAgY3VycmVuY2llczogc3RyaW5nW107XG4gICAgaXNvTGFuZzogc3RyaW5nW107XG4gICAgbGF0bG5nOiBudW1iZXJbXTtcbiAgICB0ejogc3RyaW5nO1xuXG59XG5cbmludGVyZmFjZSBJU3ViY29udGluZW50IHtcblxuICAgIG5hbWU6IHN0cmluZztcbiAgICBjb3VudHJpZXM6IElDb3VudHJ5W107XG4gICAgYm91bmRhcmllczogSUJvdW5kYXJ5W107XG59XG5cbmludGVyZmFjZSBJR2VvYnVpbGQge1xuXG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHN1YmNvbnRpbmVudHM6IElTdWJjb250aW5lbnRbXTtcbiAgICBib3VuZGFyaWVzOiBJQm91bmRhcnlbXTtcblxufVxuXG5cblxubGV0IHdvcmxkOiBJR2VvYnVpbGRbXSA9IHJlcXVpcmUoXCIuL3dvcmxkLmpzb25cIik7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExvY2FsaXplIHtcblxuICAgIGdldFBvc2l0aW9uKG86IHsgbGF0aXR1ZGU6IG51bWJlciwgbG9uZ2l0dWRlOiBudW1iZXIsIHN0YXRlPzogc3RyaW5nIH0pIHtcblxuICAgICAgICBpZiAoIShvICYmIG8ubGF0aXR1ZGUgJiYgby5sb25naXR1ZGUpKSB0aHJvdyBFcnJvcihcIkVycm9yXCIpO1xuXG4gICAgICAgIGxldCBwb3MgPSB7IGxhdGl0dWRlOiBvLmxhdGl0dWRlLCBsb25naXR1ZGU6IG8ubG9uZ2l0dWRlIH07XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG4gICAgICAgIGlmIChvLnN0YXRlICYmIF90aGlzLmdldFN0YXRlKG8uc3RhdGUpKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoby5zdGF0ZSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzcycpO1xuXG5cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZG8nKTtcblxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJ0b2RvXCIpO1xuXG5cbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gbGl2ZWxsbyBuYXppb25hbGVcbiAgICAgICAgbGV0IGFsbHByb3ZpbmNlcyA9IF90aGlzLmdldFByb3ZpbmNlc0Zyb21TdGF0ZShTdGF0ZS5uYW1lKTtcblxuXG4gICAgICAgIF8ubWFwKGFsbHByb3ZpbmNlcywgZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIGMuZGlzdGFuY2UgPSBnZW8uZ2V0RGlzdGFuY2UoeyBsYXRpdHVkZTogYy5sYXRpdHVkZSwgbG9uZ2l0dWRlOiBjLmxvbmdpdHVkZSB9LCBwb3MpO1xuXG4gICAgICAgIH0pXG5cblxuXG5cbiAgICAgICAgbGV0IHJlcHJvdiA9IF8udGFrZShfLm9yZGVyQnkoYWxscHJvdmluY2VzLCBbJ2Rpc3RhbmNlJ10sIFsnYXNjJ10pLCAyKTtcblxuICAgICAgICBsZXQgcHJvdmluY2VzID0gW107XG4gICAgICAgIF8ubWFwKHJlcHJvdiwgZnVuY3Rpb24gKGM6IElDaXR5KSB7XG5cbiAgICAgICAgICAgIF8ubWFwKF90aGlzLmdldFByb3ZpbmNlRnJvbUNpdHkoYy5uYXRpdmVOYW1lLCBTdGF0ZS5uYW1lKSwgZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICAgICAgICBwLmRpc3RhbmNlID0gZ2VvLmdldERpc3RhbmNlKHsgbGF0aXR1ZGU6IHAubGF0aXR1ZGUsIGxvbmdpdHVkZTogcC5sb25naXR1ZGUgfSwgcG9zKTtcblxuICAgICAgICAgICAgICAgIHByb3ZpbmNlcy5wdXNoKHApXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cblxuICAgICAgICBsZXQgY2l0aWVzOiBJQ2l0eVtdID0gPElDaXR5W10+Xy50YWtlKF8ub3JkZXJCeShwcm92aW5jZXMsIFsnZGlzdGFuY2UnXSwgWydhc2MnXSksIDIpO1xuXG4gICAgICAgIGlmIChjaXRpZXNbMF0uZGlzdGFuY2UgKiAxLjQgPiBjaXRpZXNbMF0uZGlzdGFuY2UpIHtcbiAgICAgICAgICAgIGNpdGllcyA9IFtjaXRpZXNbMF1dXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2l0aWVzXG5cblxuICAgIH1cblxuXG4gICAgZ2V0TG9jYXRpb24obzogeyBjaXR5OiBzdHJpbmcsIHN0YXRlPzogc3RyaW5nIH0pIHtcbiAgICAgICAgcmV0dXJuIHRydWVcblxuICAgIH1cblxuICAgIGdldGluZm8obzogeyBjaXR5OiBzdHJpbmcsIHN0YXRlPzogc3RyaW5nIH0pIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICBnZXRTdGF0ZShzdGF0ZTogc3RyaW5nLCBvPzogeyBjb250aW5lbnQ/OiBzdHJpbmcgfSk6IElzdGF0ZSB8IGJvb2xlYW4ge1xuXG5cbiAgICAgICAgbGV0IGV4aXN0cyA9IGZhbHNlO1xuXG4gICAgICAgIGxldCBhbnN3ZXI7XG5cbiAgICAgICAgXy5tYXAod29ybGQsIGZ1bmN0aW9uIChjb250aW5lbnQpIHtcblxuICAgICAgICAgICAgXy5tYXAoY29udGluZW50LnN1YmNvbnRpbmVudHMsIGZ1bmN0aW9uIChzdWJjb250aW5lbnQpIHtcblxuICAgICAgICAgICAgICAgIF8ubWFwKHN1YmNvbnRpbmVudC5jb3VudHJpZXMsIGZ1bmN0aW9uIChjb3VudHJ5KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5tYXAoY291bnRyeS5zdGF0ZXMsIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzLm5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5uYW1lID09PSBzdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gc1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5zd2VyID0gZmFsc2VcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG5cbiAgICAgICAgcmV0dXJuIGFuc3dlclxuXG4gICAgfVxuXG4gICAgZ2V0UHJvdmluY2VzRnJvbVN0YXRlKHN0YXRlKSB7XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG5cbiAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoc3RhdGUpXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwidG9kb1wiKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByb3ZpbmNlczogSUNpdHlbXSA9IFtdO1xuICAgICAgICBfLm1hcChTdGF0ZS5yZWdpb25zLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgXy5tYXAoci5jaXRpZXMsIGZ1bmN0aW9uIChjKSB7XG5cbiAgICAgICAgICAgICAgICBwcm92aW5jZXMucHVzaChjKVxuXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cblxuICAgICAgICByZXR1cm4gcHJvdmluY2VzXG5cbiAgICB9XG5cbiAgICBnZXRQcm92aW5jZUZyb21DaXR5KGNpdHksIHN0YXRlPzogc3RyaW5nKSB7XG5cbiAgICAgICAgbGV0IF90aGlzID0gdGhpcztcbiAgICAgICAgbGV0IFN0YXRlOiBJc3RhdGU7XG5cbiAgICAgICAgaWYgKHN0YXRlKSB7XG4gICAgICAgICAgICBTdGF0ZSA9IDxJc3RhdGU+X3RoaXMuZ2V0U3RhdGUoc3RhdGUpXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwidG9kb1wiKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHByb3ZpbmNlczogSUNpdHlbXSA9IFtdO1xuICAgICAgICBfLm1hcChTdGF0ZS5yZWdpb25zLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgXy5tYXAoci5wcm92aW5jZXMsIGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHAubWFpbi5uYXRpdmVOYW1lID09PSBjaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgIF8ubWFwKHAuY2l0aWVzLCBmdW5jdGlvbiAoYykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aW5jZXMucHVzaChjKVxuXG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG5cbiAgICAgICAgcmV0dXJuIHByb3ZpbmNlc1xuXG4gICAgfVxuXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
